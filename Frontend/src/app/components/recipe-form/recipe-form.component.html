<!-- Recipe Form Template -->
<div class="form-container">
    <mat-card class="form-card">
        <div class="form-header">
            <mat-icon class="form-icon">{{ isEditMode ? 'edit' : 'add_circle' }}</mat-icon>
            <h1>{{ isEditMode ? 'Edit Recipe' : 'Create New Recipe' }}</h1>
            <p>{{ isEditMode ? 'Update your recipe details' : 'Share your culinary creation' }}</p>
        </div>

        <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Recipe Title</mat-label>
                <input matInput formControlName="title" placeholder="Grandma's Chocolate Cake">
                <mat-icon matPrefix>restaurant</mat-icon>
                <mat-error *ngIf="recipeForm.get('title')?.hasError('required')">Required</mat-error>
                <mat-error *ngIf="recipeForm.get('title')?.hasError('minlength')">Min 3 chars</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Category</mat-label>
                <mat-select formControlName="categoryId">
                    <mat-option *ngFor="let cat of categories" [value]="cat.categoryId">
                        {{ cat.categoryName }}
                    </mat-option>
                </mat-select>
                <mat-icon matPrefix>category</mat-icon>
                <mat-error>Select a category</mat-error>
            </mat-form-field>

            <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Cooking Time (min)</mat-label>
                    <input matInput type="number" formControlName="cookingTime" min="1">
                    <mat-icon matPrefix>schedule</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Servings</mat-label>
                    <input matInput type="number" formControlName="servings" min="1">
                    <mat-icon matPrefix>people</mat-icon>
                </mat-form-field>
            </div>

            <div class="file-upload-container full-width">
                <label class="file-label">Upload Recipe Image</label><br>
                <input type="file" (change)="onFileSelected($event)" accept="image/jpeg, image/png, image/webp"
                    class="file-input">
                <!-- Hidden inputs to keep form sync -->
                <input type="hidden" formControlName="imageUrl">
                <input type="hidden" formControlName="imageFile">
            </div>

            <div *ngIf="previewUrl || recipeForm.get('imageUrl')?.value" class="image-preview">
                <img [src]="previewUrl || recipeForm.get('imageUrl')?.value" alt="Preview"
                    (error)="onPreviewError($event)">
            </div>

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Ingredients (comma-separated)</mat-label>
                <textarea matInput formControlName="ingredients" rows="4"
                    placeholder="2 cups flour, 1 cup sugar, 3 eggs"></textarea>
                <mat-icon matPrefix>shopping_cart</mat-icon>
                <mat-hint>Separate each ingredient with a comma</mat-hint>
                <mat-error>Required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Instructions (one per line)</mat-label>
                <textarea matInput formControlName="steps" rows="6"
                    placeholder="Preheat oven to 350Â°F&#10;Mix ingredients&#10;Bake 30 min"></textarea>
                <mat-icon matPrefix>menu_book</mat-icon>
                <mat-hint>Each step on a new line</mat-hint>
                <mat-error>Required</mat-error>
            </mat-form-field>

            <button mat-raised-button class="submit-btn" type="submit" [disabled]="recipeForm.invalid || isLoading">
                <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
                <mat-icon *ngIf="!isLoading">{{ isEditMode ? 'save' : 'publish' }}</mat-icon>
                <span *ngIf="!isLoading">{{ isEditMode ? 'Save Changes' : 'Publish Recipe' }}</span>
            </button>
        </form>
    </mat-card>
</div>